/* Design tokens and dark mode */
:root {
  /* Dark theme (slightly lighter than before) */
  --bg: #141a21;
  --panel: #1a232e;
  --border: #2a3542;
  --text: #e7ecf2;
  --muted: #9fb0c1;
  --accent: #3aa0ff;
  --brand: #8C3636;
  --ok: #21c26b;
  --warn: #ffb300;
  --err: #ef5350;
  --chip: #1b2631;
  /* Stage fill colors for sparkline */
  /* Heater stage backdrop (single hue, varying opacity) */
  --stage1: rgba(239, 83, 80, 0.12);   /* stage 1 (40%) */
  --stage2: rgba(239, 83, 80, 0.22);   /* stage 2 (60%) */
  --stageBoth: rgba(239, 83, 80, 0.32);/* both (100%) */

  --radius: 12px;
  --shadow: 0 1px 2px rgba(0,0,0,.25), 0 8px 28px rgba(0,0,0,.25);
}

@media (prefers-color-scheme: light) {
  :root:not([data-theme="dark"]) {
    /* Light theme (darker) */
    --bg: #e2e7ee;
    --panel: #eaedf3;
    --border: #c6ceda;
    --text: #111;
    --muted: #4c566a;
    --chip: #dfe4eb;
    --stage1: rgba(239, 83, 80, 0.14);
    --stage2: rgba(239, 83, 80, 0.26);
    --stageBoth: rgba(239, 83, 80, 0.36);
  }
}

html, body { margin:0; padding:0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; font-size: 17px; }

/* Offline banner */
#offline_banner { position: sticky; top:0; background:#402; color:#fff; padding:8px 12px; text-align:center; z-index: 3; }

/* Top bar */
.topbar { display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap:12px; padding:10px 12px; border-bottom:1px solid var(--border); background: var(--panel); position: sticky; top:0; z-index:2; }
.brand { font-weight:600; letter-spacing:.3px; justify-self:start; font-size: 36px; margin-left: 17px; }
.center-icons { display:flex; align-items:center; gap:12px; justify-self:center; }
.status { display:flex; align-items:center; gap:12px; justify-self:end; }
.spacer { flex:1; }

/* Layout */
.layout { display:grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap:16px; padding:16px; }
.card { background: var(--panel); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden; }
.card-title { padding:12px 14px; font-weight:600; font-size: 24px; border-bottom:1px solid var(--border); }
.section { padding:12px 14px; }
.section + .section { border-top:1px solid var(--border); }
.section-title { color: var(--muted); font-size: 12px; text-transform: uppercase; letter-spacing:.08em; margin-bottom:8px; }

/* Grids */
.grid { display:grid; gap:10px; }
.grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
.kv { display:flex; align-items:baseline; gap:8px; --kv-size: 1.08rem; }
.kv > div:nth-child(1) { color: var(--muted); min-width: 80px; }
.kv > div:nth-child(2) { font-variant-numeric: tabular-nums; font-weight:700; font-size: var(--kv-size); }
.kv #time, .kv #count, .kv #old { color: var(--muted); font-weight: 400; font-size: inherit; font-variant-numeric: normal; }
.temps .kv { --kv-size: 1.25rem; }
.unit { color: var(--muted); }
/* Units 2px smaller than corresponding value */
.kv .unit { font-size: calc(var(--kv-size) - 2px); }

/* Stages */
.stages { display:flex; gap:10px; }
.stage-pill { display:inline-flex; align-items:center; justify-content:center; min-width:66px; height:48px; padding:0 12px; border-radius:999px; background: #213041; color:#dfe7ef; border:1px solid var(--border); font-weight:800; font-size: 1rem; }
.indicator-on { background:#2a3d52; box-shadow: inset 0 0 0 5px #ef5350; }
.indicator-off { background:#1b2633; opacity:.65; }

/* Target / stepper */
.target-row { display:flex; align-items:center; gap:16px; justify-content:flex-start; }
.stepper-left, .stepper-right { display:flex; gap:8px; }
.target-wrap { --target-size: 52px; }
.target { font-size: var(--target-size); font-weight:900; letter-spacing: .5px; min-width: 120px; text-align:left; }
.stepper { display:flex; gap:8px; }

/* Buttons */
.btn { appearance:none; border:1px solid var(--border); background: var(--chip); color: var(--text); border-radius:12px; padding:12px 16px; font-weight:800; cursor:pointer; font-size: 22px; min-width: 44px; min-height: 44px; }
.stepper .btn { font-size: 28px; padding: 12px 18px; min-width: 48px; min-height: 48px; }
.stepper #decrement2, .stepper #increment2 { font-size: 36px; }
.btn:hover { filter: brightness(1.1); }
.btn-secondary { background: transparent; border-color:#2a3d50; }
.btn-ghost { background: transparent; border-color: transparent; }
.chip { border:1px solid var(--border); background: var(--chip); padding:6px 10px; border-radius:10px; color:var(--text); }

.schedule-row { display:flex; gap:16px; flex-wrap:wrap; }
.status-row { gap:8px; }
.status-row .kv { gap:6px; }
.status-row .kv > div:nth-child(1) { min-width: auto; }
.schedule-edit .row { display:flex; align-items:center; gap:10px; margin:6px 0; }
.schedule-edit .row label { color: var(--muted); min-width: 80px; display:inline-block; }
.schedule-edit input[type="time"],
.schedule-edit input[type="number"] {
  /* Match the visual of chips in the schedule row */
  background: var(--chip);
  color: var(--text);
  border:1px solid var(--border);
  border-radius:10px;
  padding:6px 10px;
  font-size: 1rem;
  min-height: 32px;
}
/* Subtle polish for time inputs */
.schedule-edit input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(80%); opacity: .8; }
.schedule-edit input[type="number"]::-webkit-outer-spin-button,
.schedule-edit input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.schedule-edit input[type="number"] { -moz-appearance: textfield; }
.check {
  /* Chip container that holds a toggle switch and label */
  color: var(--text);
  display:flex; align-items:center; gap:10px;
  background: var(--chip);
  border:1px solid var(--border);
  border-radius:10px;
  padding:6px 10px;
}
/* CSS-only toggle switch keeping the same checkbox element */
.check input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  width: 42px;
  height: 24px;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: #1f2b3a;
  position: relative;
  outline: none;
  cursor: pointer;
  transition: background .2s ease, border-color .2s ease, box-shadow .2s ease;
}
.check input[type="checkbox"]::after {
  content: "";
  position: absolute;
  top: 2px; left: 2px;
  width: 20px; height: 20px;
  border-radius: 50%;
  background: #fff;
  box-shadow: 0 1px 2px rgba(0,0,0,.3);
  transition: transform .2s ease;
}
.check input[type="checkbox"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}
.check input[type="checkbox"]:checked::after {
  transform: translateX(18px);
}
.check input[type="checkbox"]:focus-visible {
  box-shadow: 0 0 0 2px rgba(58,160,255,.35);
}

.override-row { display:flex; gap:12px; align-items:center; }

.quick-actions { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }

.status-line { color: var(--muted); }

.spark-wrap { border:1px solid var(--border); background:#0b1016; border-radius:8px; overflow:hidden; height:140px; }
.spark-wrap canvas { width:100%; height:100%; display:block; }

/* Footer */
.footer { display:flex; align-items:center; gap:16px; padding: 10px 12px 24px; }
.footer .meta { display:flex; gap:16px; color: var(--muted); }
.footer .link { color: var(--brand); text-decoration:none; font-weight:600; }

/* Icons */
.icon-wifi { mask: url("wifi.svg"); -webkit-mask-image: url("wifi.svg"); }
.icon-bluetooth { mask: url("bluetooth.svg"); -webkit-mask-image: url("bluetooth.svg"); }
.icon-matter { mask: url("matter.svg"); -webkit-mask-image: url("matter.svg"); }
.icon-tools { mask: url("tools.svg"); -webkit-mask-image: url("tools.svg"); }
.icon-graph { mask: url("graph.svg"); -webkit-mask-image: url("graph.svg"); }
.icon-upload { mask: url("upload.svg"); -webkit-mask-image: url("upload.svg"); }
.icon-compact { mask: url("compact.svg"); -webkit-mask-image: url("compact.svg"); }
.icon { display:inline-block; width: 24px; height: 24px; background:#6d7e90; mask-size: cover; -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat; mask-position:center; margin: 6px; border-radius:999px; }
.icon:hover, .icon:focus { background: #c2d6ff; }

/* In the footer, the flex items are the <a> wrappers for Tools/Graph,
   but the upload icon is the flex item itself. Remove icon margins so
   spacing comes solely from the footer's flex gap. */
.footer .icon { margin: 0; cursor: pointer; }

/* Toast */
#toast { position: fixed; left:50%; transform: translateX(-50%); bottom: 16px; background: #1b2a3a; color: var(--text); padding: 10px 16px; border-radius: 10px; border:1px solid var(--border); box-shadow: var(--shadow); z-index: 5; }

/* Chip style applied to schedule values */
.schedule-row .value { background: var(--chip); border:1px solid var(--border); border-radius: 10px; padding:6px 10px; }
/* Override heavier .kv > div:nth-child(2) weight specifically for chips */
.schedule-row .kv > div.value { font-weight: 400; }

/* Target value + unit layout and unit size */
.target-wrap { display:flex; align-items:baseline; gap:8px; }
.unit-lg { font-size: calc(var(--target-size) - 2px); color: var(--muted); }

/* Modal */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,.4); display:flex; align-items:center; justify-content:center; z-index: 6; }
/* Ensure hidden attribute really hides the modal even though .modal sets display */
.modal[hidden] { display: none !important; }
.modal-card { width: min(520px, 92vw); background: var(--panel); border:1px solid var(--border); border-radius: 12px; box-shadow: var(--shadow); }
.modal-title { padding: 12px 14px; border-bottom: 1px solid var(--border); font-weight: 700; }
.modal-body { display:flex; flex-direction: column; gap:8px; padding: 12px 14px; }
.modal-body input[type="file"],
.modal-body input[type="text"] { background: var(--chip); color: var(--text); border:1px solid var(--border); border-radius: 10px; padding:8px; }
.modal-actions { display:flex; gap:10px; justify-content:flex-end; padding: 12px 14px; border-top: 1px solid var(--border); }
.hint { color: var(--muted); font-size: 12px; }
