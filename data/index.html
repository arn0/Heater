<!doctype html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Radiator</title>
  <!-- Keep D3 for existing reduceData() usage in index.js -->
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <link rel="stylesheet" type="text/css" href="index.css">
  <script src="index.js" type="module" defer></script>
  <link rel="icon" href="favicon.ico">
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" content="#0e1217">
</head>

<body>
  <div id="offline_banner" role="status" aria-live="polite" hidden>Offline â€“ opnieuw verbindenâ€¦</div>

  <header class="topbar" role="banner">
    <div class="brand">Radiator</div>
    <div class="center-icons" aria-hidden="false">
      <div id="wifi" class="icon icon-wifi" aria-label="Wiâ€‘Fi status" role="img"></div>
      <div id="blue" class="icon icon-bluetooth" aria-label="Bluetooth status" role="img"></div>
    </div>
    <div class="status">
      <div id="worker_badge" class="chip" title="SharedWorker" style="display:none;">SW</div>
      <button id="themeToggle" class="chip" aria-pressed="false" title="Schakel donker/licht">ðŸŒ™</button>
    </div>
  </header>

  <main class="layout" role="main">
    <!-- Now -->
    <section class="card" aria-labelledby="nowTitle">
      <div class="card-title" id="nowTitle">Nu</div>

      <div class="section">
        <div class="section-title">Temperatuur</div>
        <div class="grid grid-2 temps">
          <div class="kv"><div>Ruimte</div><div id="te_rem">--.-</div><span class="unit">Â°C</span></div>
          <div class="kv"><div>Buiten</div><div id="te_out">--.-</div><span class="unit">Â°C</span></div>
          <div class="kv"><div>Boven</div><div id="te_top">--.-</div><span class="unit">Â°C</span></div>
          <div class="kv"><div>Front</div><div id="te_fnt">--.-</div><span class="unit">Â°C</span></div>
          <div class="kv"><div>Onder</div><div id="te_bot">--.-</div><span class="unit">Â°C</span></div>
          <div class="kv"><div>Achter</div><div id="te_bck">--.-</div><span class="unit">Â°C</span></div>
          <div class="kv"><div>Chip</div><div id="te_chp">--.-</div><span class="unit">Â°C</span></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Energie</div>
        <div class="grid grid-2">
          <div class="kv"><div>Spanning</div><div id="volt">---.-</div><span class="unit">V</span></div>
          <div class="kv"><div>Stroom</div><div id="amp">-.-</div><span class="unit">A</span></div>
          <div class="kv"><div>Vermogen</div><div id="watt">----.-</div><span class="unit">W</span></div>
          <div class="kv"><div>Energie</div><div id="kwh">----.-</div><span class="unit">kWh</span></div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Elementen</div>
        <div class="stages">
          <div id="indicator1" class="stage-pill indicator-off" aria-live="polite">I</div>
          <div id="indicator2" class="stage-pill indicator-off" aria-live="polite">II</div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Laatste uur</div>
        <div class="spark-wrap"><canvas id="spark_rem" width="600" height="120" aria-label="Temperatuur sparkline"></canvas></div>
      </div>
    </section>

    <!-- Control -->
    <section class="card" aria-labelledby="ctrlTitle">
      <div class="card-title" id="ctrlTitle">Instellen</div>

      <div class="section">
        <div class="section-title">Doel</div>
        <div class="target-row">
          <div class="stepper stepper-left">
            <button class="btn" id="decrement2" aria-label="-1.0">âˆ’</button>
            <button class="btn" id="decrement" aria-label="-0.1">âˆ’</button>
          </div>
          <div class="target-wrap"><div id="input" class="target">--.-</div><span class="unit unit-lg">Â°C</span></div>
          <div class="stepper stepper-right">
            <button class="btn" id="increment" aria-label="+0.1">+</button>
            <button class="btn" id="increment2" aria-label="+1.0">+</button>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Schema</div>
        <div class="schedule-row">
          <div class="kv"><div>Modus</div><div id="schedule_mode" class="value chip">-</div></div>
          <div class="kv"><div>Volgende</div><div id="schedule_next" class="value chip">-</div></div>
          <div class="kv"><div>Doel</div><div id="scheduled_target" class="value chip">-</div><span class="unit">Â°C</span></div>
        </div>
        <div class="schedule-edit">
          <div class="row">
            <label for="day_time">Dag</label>
            <input type="time" id="day_time" value="07:00" step="900">
            <input type="number" id="day_target" value="20.0" min="1" max="25" step="0.1">
            <span class="unit">Â°C</span>
          </div>
          <div class="row">
            <label for="night_time">Nacht</label>
            <input type="time" id="night_time" value="23:00" step="900">
            <input type="number" id="night_target" value="20.0" min="1" max="25" step="0.1">
            <span class="unit">Â°C</span>
            <label class="check"><input type="checkbox" id="night_check"> activeren</label>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Override</div>
        <div class="override-row">
          <div id="override_state" class="chip" aria-live="polite">Uit</div>
          <button id="override_clear" class="btn btn-secondary" disabled>Hervat schema</button>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Status</div>
        <div class="schedule-row status-row">
          <div class="kv"><div>Laatste update</div><div id="time" aria-live="polite">--:--:--</div></div>
          <div class="kv"><div>Records</div><div id="count">-</div></div>
          <div class="kv"><div>Oudste</div><div id="old">-</div></div>
        </div>
        <div id="status_line" class="status-line" aria-live="polite">Verbonden</div>
      </div>
    </section>
  </main>

  <div class="footer">
    <a href="graph.html"><div id="graph" class="icon icon-graph" title="Klassieke grafiek"></div></a>
    <a href="chart-n.html" class="link">Nieuwe grafiek</a>
    <a href="config.json" class="link" download target="_blank" rel="noopener">Download config</a>
    <div id="upload_icon" class="icon icon-upload" title="Upload"></div>
    <div id="compact_icon" class="icon icon-compact" title="Compactie"></div>
    <a href="idb-admin.html" class="link">IDB</a>
    <div class="spacer"></div>
  </div>

  <div id="toast" role="status" aria-live="polite" hidden></div>

  <!-- Simple upload modal -->
  <div id="upload_modal" class="modal" hidden>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="upload_title">
      <div class="modal-title" id="upload_title">Bestand uploaden</div>
      <div class="modal-body">
        <label for="upload_file">Bestand(en)</label>
        <input id="upload_file" type="file" multiple>
        <label for="upload_path" style="margin-top:8px">Pad op server</label>
        <input id="upload_path" type="text" placeholder="bestandsnaam.ext of map/">
        <div class="hint">- Max 200 KB per bestand
          - Voor meerdere bestanden: geef optioneel een map met afsluitende "/" (bijv. data/)</div>
      </div>
      <div class="modal-actions">
        <button id="upload_send" class="btn" type="button">Upload</button>
        <button id="upload_close" class="btn btn-secondary" type="button">Annuleren</button>
      </div>
    </div>
  </div>

  <!-- Compaction modal -->
  <div id="compact_modal" class="modal" hidden>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="compact_title">
      <div class="modal-title" id="compact_title">Compactie</div>
      <div class="modal-body">
        <div class="stage-block">
          <div class="stage-title">Stage 1</div>
          <label for="cmp_s1_age">Ouder dan (uur)</label>
          <input id="cmp_s1_age" type="number" min="0" step="1" value="1">
          <label for="cmp_s1_interval">Interval (s)</label>
          <input id="cmp_s1_interval" type="number" min="1" step="1" value="60">
        </div>
        <div class="stage-block">
          <div class="stage-title">Stage 2</div>
          <label for="cmp_s2_age">Ouder dan (uur)</label>
          <input id="cmp_s2_age" type="number" min="0" step="1" value="48">
          <label for="cmp_s2_interval">Interval (s)</label>
          <input id="cmp_s2_interval" type="number" min="1" step="1" value="600">
        </div>
        <div class="stage-block">
          <div class="stage-title">Stage 3</div>
          <label for="cmp_s3_age">Ouder dan (uur)</label>
          <input id="cmp_s3_age" type="number" min="0" step="1" value="120">
          <label for="cmp_s3_interval">Interval (s)</label>
          <input id="cmp_s3_interval" type="number" min="1" step="1" value="3600">
        </div>
        <div class="hint">Compactie reduceert oude data tot vaste intervallen. Het half-venster wordt automatisch afgeleid uit het interval.</div>
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:8px; margin-top:8px;">
          <div>Status</div><div id="cmp_status">Idle</div>
          <div>Fase</div><div id="cmp_phase">-</div>
          <div>Voortgang</div><div id="cmp_progress">-</div>
          <div>Gestart</div><div id="cmp_started">-</div>
          <div>Klaar</div><div id="cmp_finished">-</div>
        </div>
        <div class="hint" id="perf_line">Chart render avg: <span id="perf_chart">-</span> ms</div>
      </div>
      <div class="modal-actions">
        <button id="cmp_start" class="btn" type="button">Start</button>
        <button id="cmp_stop" class="btn btn-secondary" type="button">Stop</button>
        <button id="cmp_close" class="btn btn-secondary" type="button">Sluiten</button>
      </div>
    </div>
  </div>

</body>
</html>
